(function(n,t){if(typeof define=="function"&&define.amd)define(["underscore","jquery","exports"],function(i,r,u){n.Backbone=t(n,u,i,r)});else if(typeof exports!="undefined"){var i=require("underscore");t(n,exports,i)}else n.Backbone=t(n,{},n._,n.jQuery||n.Zepto||n.ender||n.$)})(this,function(n,t,i,r){var rt=n.Backbone,l=[],bt=l.push,s=l.slice,kt=l.splice,e,p,w,b,d,g,it,a,o;t.VERSION="1.1.2",t.$=r,t.noConflict=function(){return n.Backbone=rt,this},t.emulateHTTP=!1,t.emulateJSON=!1;var u=t.Events={on:function(n,t,i){if(!h(this,"on",n,[t,i])||!t)return this;this._events||(this._events={});var r=this._events[n]||(this._events[n]=[]);return r.push({callback:t,context:i,ctx:i||this}),this},once:function(n,t,r){if(!h(this,"once",n,[t,r])||!t)return this;var f=this,u=i.once(function(){f.off(n,u),t.apply(this,arguments)});u._callback=t;return this.on(n,u,r)},off:function(n,t,r){var o,u,s,c,f,l,e,a;if(!this._events||!h(this,"off",n,[t,r]))return this;if(!n&&!t&&!r)return this._events=void 0,this;for(c=n?[n]:i.keys(this._events),f=0,l=c.length;f<l;f++)if(n=c[f],s=this._events[n]){if(this._events[n]=o=[],t||r)for(e=0,a=s.length;e<a;e++)u=s[e],(t&&t!==u.callback&&t!==u.callback._callback||r&&r!==u.context)&&o.push(u);o.length||delete this._events[n]}return this},trigger:function(n){var t,i,r;return this._events?(t=s.call(arguments,1),!h(this,"trigger",n,t))?this:(i=this._events[n],r=this._events.all,i&&y(i,t),r&&y(r,arguments),this):this},stopListening:function(n,t,r){var u=this._listeningTo,e,f;if(!u)return this;e=!t&&!r,r||typeof t!="object"||(r=this),n&&((u={})[n._listenId]=n);for(f in u)n=u[f],n.off(t,r,this),(e||i.isEmpty(n._events))&&delete this._listeningTo[f];return this}},v=/\s+/,h=function(n,t,i,r){var f,e,u,o;if(!i)return!0;if(typeof i=="object"){for(f in i)n[t].apply(n,[f,i[f]].concat(r));return!1}if(v.test(i)){for(e=i.split(v),u=0,o=e.length;u<o;u++)n[t].apply(n,[e[u]].concat(r));return!1}return!0},y=function(n,t){var i,r=-1,u=n.length,f=t[0],e=t[1],o=t[2];switch(t.length){case 0:while(++r<u)(i=n[r]).callback.call(i.ctx);return;case 1:while(++r<u)(i=n[r]).callback.call(i.ctx,f);return;case 2:while(++r<u)(i=n[r]).callback.call(i.ctx,f,e);return;case 3:while(++r<u)(i=n[r]).callback.call(i.ctx,f,e,o);return;default:while(++r<u)(i=n[r]).callback.apply(i.ctx,t);return}},ut={listenTo:"on",listenToOnce:"once"};i.each(ut,function(n,t){u[t]=function(t,r,u){var f=this._listeningTo||(this._listeningTo={}),e=t._listenId||(t._listenId=i.uniqueId("l"));return f[e]=t,u||typeof r!="object"||(u=this),t[n](r,u,this),this}}),u.bind=u.on,u.unbind=u.off,i.extend(t,u),e=t.Model=function(n,t){var r=n||{};t||(t={}),this.cid=i.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=i.defaults({},r,i.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)},i.extend(e.prototype,u,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(n){return this.attributes[n]},escape:function(n){return i.escape(this.get(n))},has:function(n){return this.get(n)!=null},set:function(n,t,r){var u,f,l,e,h,c,a,o,s,v;if(n==null)return this;if(typeof n=="object"?(f=n,r=t):(f={})[n]=t,r||(r={}),!this._validate(f,r))return!1;l=r.unset,h=r.silent,e=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=i.clone(this.attributes),this.changed={}),o=this.attributes,a=this._previousAttributes,this.idAttribute in f&&(this.id=f[this.idAttribute]);for(u in f)t=f[u],i.isEqual(o[u],t)||e.push(u),i.isEqual(a[u],t)?delete this.changed[u]:this.changed[u]=t,l?delete o[u]:o[u]=t;if(!h)for(e.length&&(this._pending=r),s=0,v=e.length;s<v;s++)this.trigger("change:"+e[s],this,o[e[s]],r);if(c)return this;if(!h)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(n,t){return this.set(n,void 0,i.extend({},t,{unset:!0}))},clear:function(n){var t={},r;for(r in this.attributes)t[r]=void 0;return this.set(t,i.extend({},n,{unset:!0}))},hasChanged:function(n){return n==null?!i.isEmpty(this.changed):i.has(this.changed,n)},changedAttributes:function(n){var u,t,f,r;if(!n)return this.hasChanged()?i.clone(this.changed):!1;t=!1,f=this._changing?this._previousAttributes:this.attributes;for(r in n)i.isEqual(f[r],u=n[r])||((t||(t={}))[r]=u);return t},previous:function(n){return n==null||!this._previousAttributes?null:this._previousAttributes[n]},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(n){n=n?i.clone(n):{},n.parse===void 0&&(n.parse=!0);var t=this,r=n.success;return n.success=function(i){if(!t.set(t.parse(i,n),n))return!1;r&&r(t,i,n),t.trigger("sync",t,i,n)},o(this,n),this.sync("read",this,n)},save:function(n,t,r){var u,e,c,s=this.attributes,f,h;if(n==null||typeof n=="object"?(u=n,r=t):(u={})[n]=t,r=i.extend({validate:!0},r),u&&!r.wait){if(!this.set(u,r))return!1}else if(!this._validate(u,r))return!1;return u&&r.wait&&(this.attributes=i.extend({},s,u)),r.parse===void 0&&(r.parse=!0),f=this,h=r.success,r.success=function(n){f.attributes=s;var t=f.parse(n,r);if(r.wait&&(t=i.extend(u||{},t)),i.isObject(t)&&!f.set(t,r))return!1;h&&h(f,n,r),f.trigger("sync",f,n,r)},o(this,r),e=this.isNew()?"create":r.patch?"patch":"update",e==="patch"&&(r.attrs=u),c=this.sync(e,this,r),u&&r.wait&&(this.attributes=s),c},destroy:function(n){var f;n=n?i.clone(n):{};var t=this,r=n.success,u=function(){t.trigger("destroy",t,t.collection,n)};return(n.success=function(i){(n.wait||t.isNew())&&u(),r&&r(t,i,n),t.isNew()||t.trigger("sync",t,i,n)},this.isNew())?(n.success(),!1):(o(this,n),f=this.sync("delete",this,n),n.wait||u(),f)},url:function(){var n=i.result(this,"urlRoot")||i.result(this.collection,"url")||a();return this.isNew()?n:n.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(n){return n},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(n){return this._validate({},i.extend(n||{},{validate:!0}))},_validate:function(n,t){if(!t.validate||!this.validate)return!0;n=i.extend({},this.attributes,n);var r=this.validationError=this.validate(n,t)||null;return r?(this.trigger("invalid",this,r,i.extend(t,{validationError:r})),!1):!0}}),p=["keys","values","pairs","invert","pick","omit"],i.each(p,function(n){e.prototype[n]=function(){var t=s.call(arguments);return t.unshift(this.attributes),i[n].apply(i,t)}});var c=t.Collection=function(n,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),n&&this.reset(n,i.extend({silent:!0},t))},ft={add:!0,remove:!0,merge:!0},et={add:!0,remove:!1};i.extend(c.prototype,u,{model:e,initialize:function(){},toJSON:function(n){return this.map(function(t){return t.toJSON(n)})},sync:function(){return t.sync.apply(this,arguments)},add:function(n,t){return this.set(n,i.extend({merge:!1},t,et))},remove:function(n,t){var e=!i.isArray(n),u,o,f,r;for(n=e?[n]:i.clone(n),t||(t={}),u=0,o=n.length;u<o;u++)(r=n[u]=this.get(n[u]),r)&&(delete this._byId[r.id],delete this._byId[r.cid],f=this.indexOf(r),this.models.splice(f,1),this.length--,t.silent||(t.index=f,r.trigger("remove",r,this,t)),this._removeReference(r,t));return e?n[0]:n},set:function(n,t){var v,d;t=i.defaults({},t,ft),t.parse&&(n=this.parse(n,t)),v=!i.isArray(n),n=v?n?[n]:[]:i.clone(n);for(var y,u,f,c,l,p=t.at,nt=this.model,w=this.comparator&&p==null&&t.sort!==!1,tt=i.isString(this.comparator)?this.comparator:null,s=[],b=[],a={},g=t.add,it=t.merge,k=t.remove,h=!w&&g&&k?[]:!1,r=0,o=n.length;r<o;r++){if(f=n[r]||{},y=f instanceof e?u=f:f[nt.prototype.idAttribute||"id"],c=this.get(y))k&&(a[c.cid]=!0),it&&(f=f===u?u.attributes:f,t.parse&&(f=c.parse(f,t)),c.set(f,t),w&&!l&&c.hasChanged(tt)&&(l=!0)),n[r]=c;else if(g){if(u=n[r]=this._prepareModel(f,t),!u)continue;s.push(u),this._addReference(u,t)}u=c||u,h&&(u.isNew()||!a[u.id])&&h.push(u),a[u.id]=!0}if(k){for(r=0,o=this.length;r<o;++r)a[(u=this.models[r]).cid]||b.push(u);b.length&&this.remove(b,t)}if(s.length||h&&h.length)if(w&&(l=!0),this.length+=s.length,p!=null)for(r=0,o=s.length;r<o;r++)this.models.splice(p+r,0,s[r]);else for(h&&(this.models.length=0),d=h||s,r=0,o=d.length;r<o;r++)this.models.push(d[r]);if(l&&this.sort({silent:!0}),!t.silent){for(r=0,o=s.length;r<o;r++)(u=s[r]).trigger("add",u,this,t);(l||h&&h.length)&&this.trigger("sort",this,t)}return v?n[0]:n},reset:function(n,t){t||(t={});for(var r=0,u=this.models.length;r<u;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),n=this.add(n,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),n},push:function(n,t){return this.add(n,i.extend({at:this.length},t))},pop:function(n){var t=this.at(this.length-1);return this.remove(t,n),t},unshift:function(n,t){return this.add(n,i.extend({at:0},t))},shift:function(n){var t=this.at(0);return this.remove(t,n),t},slice:function(){return s.apply(this.models,arguments)},get:function(n){if(n!=null)return this._byId[n]||this._byId[n.id]||this._byId[n.cid]},at:function(n){return this.models[n]},where:function(n,t){return i.isEmpty(n)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var i in n)if(n[i]!==t.get(i))return!1;return!0})},findWhere:function(n){return this.where(n,!0)},sort:function(n){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return n||(n={}),i.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),n.silent||this.trigger("sort",this,n),this},pluck:function(n){return i.invoke(this.models,"get",n)},fetch:function(n){n=n?i.clone(n):{},n.parse===void 0&&(n.parse=!0);var r=n.success,t=this;return n.success=function(i){var u=n.reset?"reset":"set";t[u](i,n),r&&r(t,i,n),t.trigger("sync",t,i,n)},o(this,n),this.sync("read",this,n)},create:function(n,t){if(t=t?i.clone(t):{},!(n=this._prepareModel(n,t)))return!1;t.wait||this.add(n,t);var u=this,r=t.success;return t.success=function(n,i){t.wait&&u.add(n,t),r&&r(n,i,t)},n.save(null,t),n},parse:function(n){return n},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(n,t){if(n instanceof e)return n;t=t?i.clone(t):{},t.collection=this;var r=new this.model(n,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_addReference:function(n){this._byId[n.cid]=n,n.id!=null&&(this._byId[n.id]=n),n.collection||(n.collection=this);n.on("all",this._onModelEvent,this)},_removeReference:function(n){this===n.collection&&delete n.collection,n.off("all",this._onModelEvent,this)},_onModelEvent:function(n,t,i,r){(n!=="add"&&n!=="remove"||i===this)&&(n==="destroy"&&this.remove(t,r),t&&n==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}}),w=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"],i.each(w,function(n){c.prototype[n]=function(){var t=s.call(arguments);return t.unshift(this.models),i[n].apply(i,t)}}),b=["groupBy","countBy","sortBy","indexBy"],i.each(b,function(n){c.prototype[n]=function(t,r){var u=i.isFunction(t)?t:function(n){return n.get(t)};return i[n](this.models,u,r)}});var k=t.View=function(n){this.cid=i.uniqueId("view"),n||(n={}),i.extend(this,i.pick(n,st)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},ot=/^(\S+)\s*(.*)$/,st=["model","collection","el","id","attributes","className","tagName","events"];i.extend(k.prototype,u,{tagName:"div",$:function(n){return this.$el.find(n)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(n,i){return this.$el&&this.undelegateEvents(),this.$el=n instanceof t.$?n:t.$(n),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(n){var r,t;if(!(n||(n=i.result(this,"events"))))return this;this.undelegateEvents();for(r in n)if(t=n[r],i.isFunction(t)||(t=this[n[r]]),t){var f=r.match(ot),u=f[1],e=f[2];if(t=i.bind(t,this),u+=".delegateEvents"+this.cid,e==="")this.$el.on(u,t);else this.$el.on(u,e,t)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){var n,r;this.el?this.setElement(i.result(this,"el"),!1):(n=i.extend({},i.result(this,"attributes")),this.id&&(n.id=i.result(this,"id")),this.className&&(n["class"]=i.result(this,"className")),r=t.$("<"+i.result(this,"tagName")+">").attr(n),this.setElement(r,!1))}}),t.sync=function(n,r,u){var e=g[n],f,o,s;return i.defaults(u||(u={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON}),f={type:e,dataType:"json"},u.url||(f.url=i.result(r,"url")||a()),u.data==null&&r&&(n==="create"||n==="update"||n==="patch")&&(f.contentType="application/json",f.data=JSON.stringify(u.attrs||r.toJSON(u))),u.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),u.emulateHTTP&&(e==="PUT"||e==="DELETE"||e==="PATCH")&&(f.type="POST",u.emulateJSON&&(f.data._method=e),o=u.beforeSend,u.beforeSend=function(n){return n.setRequestHeader("X-HTTP-Method-Override",e),o?o.apply(this,arguments):void 0}),f.type==="GET"||u.emulateJSON||(f.processData=!1),f.type==="PATCH"&&d&&(f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}),s=u.xhr=t.ajax(i.extend(f,u)),r.trigger("request",r,s,u),s},d=typeof window!="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),g={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"},t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var nt=t.Router=function(n){n||(n={}),n.routes&&(this.routes=n.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},ht=/\((.*?)\)/g,ct=/(\(\?)?:\w+/g,lt=/\*\w+/g,at=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(nt.prototype,u,{initialize:function(){},route:function(n,r,u){i.isRegExp(n)||(n=this._routeToRegExp(n)),i.isFunction(r)&&(u=r,r=""),u||(u=this[r]);var f=this;return t.history.route(n,function(i){var e=f._extractParameters(n,i);f.execute(u,e),f.trigger.apply(f,["route:"+r].concat(e)),f.trigger("route",r,e),t.history.trigger("route",f,r,e)}),this},execute:function(n,t){n&&n.apply(this,t)},navigate:function(n,i){return t.history.navigate(n,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var n,t=i.keys(this.routes);(n=t.pop())!=null;)this.route(n,this.routes[n])}},_routeToRegExp:function(n){return n=n.replace(at,"\\$&").replace(ht,"(?:$1)?").replace(ct,function(n,t){return t?n:"([^/?]+)"}).replace(lt,"([^?]*?)"),new RegExp("^"+n+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(n,t){var r=n.exec(t).slice(1);return i.map(r,function(n,t){return t===r.length-1?n||null:n?decodeURIComponent(n):null})}});var f=t.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},tt=/^[#\/]|\s+$/g,vt=/^\/+|\/+$/g,yt=/msie [\w.]+/,pt=/\/$/,wt=/#.*$/;return f.started=!1,i.extend(f.prototype,u,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(n){var t=(n||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(n,t){if(n==null)if(this._hasPushState||!this._wantsHashChange||t){n=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(pt,"");n.indexOf(i)||(n=n.slice(i.length))}else n=this.getHash();return n.replace(tt,"")},start:function(n){var o,s;if(f.started)throw new Error("Backbone.history has already been started");f.started=!0,this.options=i.extend({root:"/"},this.options,n),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),u=document.documentMode,e=yt.exec(navigator.userAgent.toLowerCase())&&(!u||u<=7);if(this.root=("/"+this.root+"/").replace(vt,"/"),e&&this._wantsHashChange&&(o=t.$('<iframe src="javascript:0" tabindex="-1">'),this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(r)),this._hasPushState)t.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in window&&!e)t.$(window).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));if(this.fragment=r,s=this.location,this._wantsHashChange&&this._wantsPushState)if(this._hasPushState||this.atRoot())this._hasPushState&&this.atRoot()&&s.hash&&(this.fragment=this.getHash().replace(tt,""),this.history.replaceState({},document.title,this.root+this.fragment));else return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),f.started=!1},route:function(n,t){this.handlers.unshift({route:n,callback:t})},checkUrl:function(){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(n){return n=this.fragment=this.getFragment(n),i.any(this.handlers,function(t){if(t.route.test(n))return t.callback(n),!0})},navigate:function(n,t){if(!f.started)return!1;t&&t!==!0||(t={trigger:!!t});var i=this.root+(n=this.getFragment(n||""));if(n=n.replace(wt,""),this.fragment!==n){if(this.fragment=n,n===""&&i!=="/"&&(i=i.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else if(this._wantsHashChange)this._updateHash(this.location,n,t.replace),this.iframe&&n!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace));else return this.location.assign(i);if(t.trigger)return this.loadUrl(n)}},_updateHash:function(n,t,i){if(i){var r=n.href.replace(/(javascript:|#).*$/,"");n.replace(r+"#"+t)}else n.hash="#"+t}}),t.history=new f,it=function(n,t){var u=this,r,f;return r=n&&i.has(n,"constructor")?n.constructor:function(){return u.apply(this,arguments)},i.extend(r,u,t),f=function(){this.constructor=r},f.prototype=u.prototype,r.prototype=new f,n&&i.extend(r.prototype,n),r.__super__=u.prototype,r},e.extend=c.extend=nt.extend=k.extend=f.extend=it,a=function(){throw new Error('A "url" property or function must be specified');},o=function(n,t){var i=t.error;t.error=function(r){i&&i(n,r,t),n.trigger("error",n,r,t)}},t})